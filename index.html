<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVEX</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module">
        import { GoogleGenerativeAI, HarmBlockThreshold, HarmCategory } from "https://esm.run/@google/generative-ai";

        async function generateCharacter() {
            const apiKey = document.getElementById('apiKey').value;
            const personaData = document.getElementById('personaData').value;

            if (!apiKey) {
                alert('Please enter your API key at https://aistudio.google.com/app/apikey, and make sure you have text inside persona data');
                return;
            }
          
            const prompt = personaData 
                ? `You will only generate character persona using the given persona or generate a character based on the given name if there are: ${personaData}. Generated responses must be in JSON format or W++ format. The generated result must have a persona containing appearance, background story, scenario, first message, and example conversation (e.g., {{char1}: here, {{user}}: here}).`
                : 'Generate a random character if there is no given text. The character must have a unique persona and background.';

            try {
                const genAI = new GoogleGenerativeAI(apiKey);

                const safetySettings = [
                    {
                        category: HarmCategory.HARM_CATEGORY_HARASSMENT,
                        threshold: HarmBlockThreshold.BLOCK_NONE,
                    },
                    {
                        category: HarmCategory.HARM_CATEGORY_HATE_SPEECH,
                        threshold: HarmBlockThreshold.BLOCK_NONE,
                    },
                    {
                        category: HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT,
                        threshold: HarmBlockThreshold.BLOCK_NONE,
                    },
                    {
                        category: HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT,
                        threshold: HarmBlockThreshold.BLOCK_NONE,
                    },
                ];

                const model = genAI.getGenerativeModel({
                    model: "gemini-1.5-flash",
                    systemInstruction: `You will only generate character persona using the given persona or generate a character based on the given name if there are: ${personaData}. Generated responses must be in JSON format or W++ format. The generated result must have a persona containing appearance, background story, scenario, first message, and example conversation (e.g., {{char1}: here, {{user}}: here}).`,
                    safetySettings
                });

                const result = await model.generateContent(prompt);
                const output = await result.response.text();

                document.getElementById('result').textContent = output;
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Check the console for details (debugging purposes). If there is no API key in the "Gemini API Key", please get one at https://aistudio.google.com/app/apikey.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('generateBtn').addEventListener('click', generateCharacter);
        });
    </script>
    <link
        rel="icon"
        href="https://cdn.glitch.global/09e7d406-caae-4b1a-a38a-e9d7ed27db3d/4006f745-0f1a-4c7c-92f3-66bdb50df208-cover.png?v=1725294838912"
        type="image/x-icon"/>
</head>
<body>
    <h1>Whitz Character Gen</h1>
    <label for="apiKey">Gemini API Key:</label>
    <input type="text" id="apiKey" placeholder="Enter your API key">
    <br>
    <label for="personaData">Persona Data:</label>
    <textarea id="personaData" rows="6" placeholder="Enter persona data here"></textarea>
    <br>
    <button id="generateBtn">Generate Character</button>
    <h2>Result:</h2>
    <pre id="result"></pre>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const resultBox = document.getElementById('result');

            resultBox.addEventListener('dblclick', () => {
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNode(resultBox);
                selection.removeAllRanges();
                selection.addRange(range);
                document.execCommand('copy');
                alert('Text copied to clipboard!');
            });
        });
    </script>
</body>
</html>
